---
import BaseLayout from "@/layouts/BaseLayout.astro";
import { Header } from "@/sections/Header";
import { Footer } from "@/sections/Footer";
import { DeckingHero } from "@/pages/decking/sections/Hero";
import { DeckingFeatures } from "@/pages/decking/sections/Features";
import { DeckingGallery } from "@/pages/decking/sections/Gallery";
import { DeckingTestimonials } from "@/pages/decking/sections/Testimonials";
import { DeckingFAQ } from "@/pages/decking/sections/FAQ";
import { DeckingContactForm } from "@/pages/decking/sections/ContactForm";
import { GardenRoomsHero } from "@/pages/garden-rooms/sections/Hero";
import { GardenRoomsFeatures } from "@/pages/garden-rooms/sections/Features";
import { GardenRoomsGallery } from "@/pages/garden-rooms/sections/Gallery";
import { GardenRoomsTestimonials } from "@/pages/garden-rooms/sections/Testimonials";
import { GardenRoomsFAQ } from "@/pages/garden-rooms/sections/FAQ";
import { GardenRoomsContactForm } from "@/pages/garden-rooms/sections/ContactForm";
import { getAllLocations, LOCATION_SERVICES, SERVICE_NAMES, type Location, type LocationServiceSlug } from "@/data/locations";

const siteUrl = "https://glenhausgardenroom.com";

export function getStaticPaths() {
  const paths: { params: { location: string; service: string }; props: { location: Location; service: LocationServiceSlug } }[] = [];
  for (const location of getAllLocations()) {
    for (const service of LOCATION_SERVICES) {
      paths.push({
        params: { location: location.slug, service },
        props: { location, service },
      });
    }
  }
  return paths;
}

const { location, service } = Astro.props;
const serviceName = SERVICE_NAMES[service];
const serviceTitle = `${serviceName} ${location.name}`;

const title = `${serviceName} ${location.name} | Who's the Best ${serviceName} Near Me? | Glenhaus Garden Rooms`;
const description = `Looking for the best ${serviceName.toLowerCase()} in ${location.name}? Professional ${serviceName.toLowerCase()} installation across ${location.regionLabel}. Free quotes, fully insured. Serving ${location.neighborhoods.slice(0, 2).join(", ")} and more.`;
const canonical = `${siteUrl}/${location.slug}/${service}`;
const keywords = `${serviceName.toLowerCase()} ${location.name}, ${serviceName.toLowerCase()} near me, ${location.name} ${serviceName.toLowerCase()}, ${location.regionLabel}`;

const breadcrumbs = [
  { name: "Home", url: "/" },
  { name: "Locations", url: "/locations" },
  { name: location.name, url: `/${location.slug}` },
  { name: serviceName, url: `/${location.slug}/${service}` },
];

const locationProp = { name: location.name, regionLabel: location.regionLabel };
---

<BaseLayout
  title={title}
  description={description}
  canonical={canonical}
  keywords={keywords}
  breadcrumbs={breadcrumbs}
>
  <div class="text-neutral-600 text-lg not-italic normal-nums font-medium accent-auto bg-[#323232] box-border caret-transparent block tracking-[normal] leading-[27px] list-outside list-disc min-h-full pointer-events-auto text-start indent-[0px] normal-case visible border-separate font-manrope">
    <Header client:load />
    <div class="pt-[80px] md:pt-[100px]">
      {service === "decking" ? (
        <>
          <nav class="max-w-[1204px] mx-auto px-4 sm:px-5 md:px-8 mb-4" aria-label="Breadcrumb">
            <ol class="flex flex-wrap items-center gap-2 text-sm text-gray-400">
              <li><a href="/" class="hover:text-white transition-colors">Home</a></li>
              <li aria-hidden="true">/</li>
              <li><a href="/locations" class="hover:text-white transition-colors">Locations</a></li>
              <li aria-hidden="true">/</li>
              <li><a href={`/${location.slug}`} class="hover:text-white transition-colors">{location.name}</a></li>
              <li aria-hidden="true">/</li>
              <li class="text-white font-medium" aria-current="page">Decking</li>
            </ol>
          </nav>
          <DeckingHero location={locationProp} client:load />
          <DeckingFeatures location={locationProp} client:load />
          <DeckingGallery location={locationProp} client:load />
          <DeckingTestimonials client:load />
          <DeckingFAQ location={locationProp} client:load />
          <DeckingContactForm location={locationProp} client:load />
        </>
      ) : (
        <>
          <nav class="max-w-[1204px] mx-auto px-4 sm:px-5 md:px-8 mb-4" aria-label="Breadcrumb">
            <ol class="flex flex-wrap items-center gap-2 text-sm text-gray-400">
              <li><a href="/" class="hover:text-white transition-colors">Home</a></li>
              <li aria-hidden="true">/</li>
              <li><a href="/locations" class="hover:text-white transition-colors">Locations</a></li>
              <li aria-hidden="true">/</li>
              <li><a href={`/${location.slug}`} class="hover:text-white transition-colors">{location.name}</a></li>
              <li aria-hidden="true">/</li>
              <li class="text-white font-medium" aria-current="page">{serviceName}</li>
            </ol>
          </nav>
          <GardenRoomsHero location={locationProp} client:load />
          <GardenRoomsFeatures location={locationProp} client:load />
          <GardenRoomsGallery location={locationProp} client:load />
          <GardenRoomsTestimonials location={locationProp} client:load />
          <GardenRoomsFAQ location={locationProp} client:load />
          <GardenRoomsContactForm location={locationProp} client:load />
        </>
      )}
    </div>
    <Footer client:load location={{ name: location.name, regionLabel: location.regionLabel, geo: location.geo }} />
  </div>
</BaseLayout>
